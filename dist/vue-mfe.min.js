/*!
  * vue-mfe v0.1.4
  * (c) 2019 Vuchan
  * @license MIT
  */
var e,t;e=this,t=function(e,t,n){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t,n=n&&n.hasOwnProperty("default")?n.default:n;var r=function(e){return Array.isArray(e)},o=function(e){return e&&"function"==typeof e},u=function(e){return e&&"object"==typeof e},a=function(e){return"string"==typeof e},i=function(e,t){return void 0===t&&(t=!1),e.split(/-|_|\s/g).map(function(e,n){return t||0!==n?(r=e).charAt(0).toUpperCase()+r.slice(1).toLowerCase():e;var r}).join("")},c=function(e){return e&&e.default||e},f=function(e){return e.name&&e.name.includes(".")?s(e.name,"."):s(e.path,"/")};function s(e,t){return e.split(t).filter(function(e){return!Object.values(GlobalPageRouter.currentRoute.params).includes(e)}).filter(Boolean).map(function(e){return e.trim()}).shift()}var l=function(e,t,n){Object.defineProperty(e,t,{value:n,configurable:!1,enumerable:!1,writable:!1})},d=function(e){return e.reduce(function(e,t){return e.then(function(e){return t(e)}).catch(function(e){throw e})},Promise.resolve())};function h(e,t){var n=document.createElement("script");n.type="text/javascript",n.charset="utf-8",n.src=e,n.async=!0,n.setAttribute("nonce","nonce");var r=null,o=null;function u(){i(),r&&r.apply(void 0,arguments)}function a(){o&&o(t?window[t]:void 0),i()}function i(){clearTimeout(c),n.onerror=n.onload=n.onreadystatechange=null,n.remove()}document.body.appendChild(n);var c=setTimeout(function(){return u("Reject script "+e+" error")},12e4);return new Promise(function(i,c){o=i,r=c,void 0!==n.readyState?n.onreadystatechange=function(e){"loaded"!==n.readyState&&"complete"!==n.readyState||t&&!window[t]?u("Unknown error happened",e):a()}:(n.onload=function(){a()},n.onerror=function(t){u("GET "+e+" net::ERR_CONNECTION_REFUSED",t)})})}var p=!1,v=!0;function m(e,t,n){return e?o(t)&&t():o(n)&&n()}function g(){var e=arguments;return m(p,function(){return console.info.apply(console,e)})}function y(){var e=arguments,t=this,n=!p&&"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn||function(e){throw new Error(e)};return m(!0,function(){n.apply(t,e)})}t.use(n);var b=[],w={},R=null,P=[],O=function(e,t){void 0===e&&(e=[]),void 0===t&&(t="history"),P&&P.length||(P=e),function e(t,n){void 0===t&&(t=[]);void 0===n&&(n="");t.forEach(function(t){var r=t.path,o=t.name,u=t.children;n&&(r=_(r,n)),o&&!w[o]&&(w[o]=r),r&&!b.includes(r)&&b.push(r),u&&u.length&&e(u,r)})}(e);var r=new n({routes:e,mode:t,scrollBehavior:function(e,t,n){return n||{x:0,y:0}}});if(!R){R=r;var o=Object.create(null);l(o,"completePaths",_),l(o,"findRoute",E),l(o,"findPathName",C),l(o,"nameExists",S),l(o,"pathExists",A),l(R,"addRoutes",j),l(R,"helpers",o)}return r};function j(e,t){void 0===e&&(e=[]),void 0===t&&(t="/");var n,r=0,o=[],u=e.filter(function(e){return e.parentPath?Boolean(++r):(o.push(e),!1)}).filter(function(e){return!M(e)});if(t&&o.length&&u.concat(o.filter(function(e){return!M(Object.assign(e,{parentPath:t}))})),!r&&!t||0===u.length)return n=O(P),R.matcher=n.matcher,R;g("hasParentPathRouteLength: ",r),g("prependPath: ",t),g("unRegisteredRoutes: ",u),y("Add routes failed, those routes "+JSON.stringify(u)+" cannot be registered.")}function M(e,t){var n=e.path,r=e.name,o=e.parentPath,u=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&-1===t.indexOf(r)&&(n[r]=e[r]);return n}(e,["path","name","parentPath"]);void 0===t&&(t=P);var a=o?_(n,o):n,i=A(o?a:n),c=r&&S(r);m(i,function(){var e=C(r),t="\n      The path "+n+" cannot be registered "+(o?"to parentPath "+o:"")+",\n      because of it was already registered "+(e?"in pathMap "+e:"")+"before.\n    ";m("/"===n,function(){return p&&console.warn(t)},function(){return y(t)})}),m(c,function(){return y("\n      The name "+r+" cannot be registered to path "+n+"\n      "+(o?" with parentPath "+o:"")+"\n    },\n      because of it already registered in pathList "+c+" before.\n    ")});var f=Object.assign({path:"/"!==o&&n.startsWith("/")?n.replace(/^\/*/,""):n,name:r},u||{});if(o&&A(o)){var s=E(t,o);if(s)return s.children&&s.children.length?s.children.push(f):s.children=[f],!0;y("Register path '"+n+"' failed, cannot found parent path '"+o+"',\n        Are you sure the parent path exists in MasterRouter/routes before?")}else void 0!==o&&"string"==typeof o?t.push(f):y("Register path '"+n+"' failed, parentPath '"+o+" does not exist'")}function E(e,t){void 0===e&&(e=[]);for(var n=0,r=null,o=e.length;n<o;){var u=e[n],a=u.path,i=u.children;if(a===t)return u;if(i&&i.length?(r=E(i,t),n++):n++,r)return r}}function _(e,t){return"/"===t&&"/"!==e&&e.startsWith("/")?x(e):x(t)+x(e)}function x(e){return(e="/"!==e?e.replace(/\/?$/,""):e)?function(e){return"/"===e.charAt(0)}(e)?e:"/"+e:""}function A(e){return b.includes(e)}function S(e){return w[e]}function C(e){return Object.keys(w).find(function(t){return w[t]===e})}function N(){return R}var T=null;function L(e,t){var n=i(f(e)),c=B()||{},s=c.onLoadStart,l=c.onLoadSuccess,v=c.onLoadError,m=c.getNamespace;return void 0===m&&(m=function(){return"__domain__app__"+n}),o(s)&&s(n,c),g("app-name: ",n),function(e,t){return T&&T[e]?Promise.resolve(T[e]):function(){var e=B();try{return e&&e.getResource&&e.getResource()}catch(e){return Promise.reject(e)}}().then(function(n){return n?(T=Object.assign({},T,n))[e]?T[e]:(g("[vue-mfe/getRouteEntry]: resources object: ",n),y("[vue-mfe/getRouteEntry]: The '"+e+"' cannot be found in resources object: "+JSON.stringify(Object.keys(n))),void t(!1)):t({name:404})})}(n,t).then(function(e){return p&&u(e)&&!r(e)?e:function(e,t){if(r(e)&&e.length)return d(e.map(function(e){return function(){return h(e,t)}})).catch(function(e){throw e});if(a(e))return d([function(){return h(e,t)}])}(e,m(n))}).then(function(e){if(e)return G(e);throw new Error("[vue-mfe/lazyloader]: Cannot get valid value of Module "+n)}).then(function(r){if(!r)throw new Error("[vue-mfe/lazyloader]: Register dynamic routes failed");t(e),o(l)&&l(n,c)}).catch(function(e){o(v)?v(e,t):t(!1)})}function G(e){e=c(e);var t=N(),n=t.app||{},a=null;if(e){if(o(e))return Promise.resolve(e(n)).then(function(e){return r(e)&&e.length?t.addRoutes(e):!1===e?y("[vue-mfe/installModule]: Module "+name+" initialize failed."):void 0});if(r(e))a=e;else if(u(e)){if(o(e.init)&&e.init(n),!e.routes||!e.routes.length)return y("[vue-mfe/installModule]: Must pass a valid routes array in 'module.routes' property of "+name+"!");a=e.routes}return t.addRoutes(a),!0}return!1}function k(e,t,n){var r=z(),o=r?j(e):O(e,n);return r||(o._config=t||{},l(window,"GlobalPageRouter",o),function(e){e.beforeEach(function(t,n,r){p||v?0===e.match(t.path).matched.length?L(t,r):r():r({name:404})})}(o)),o}function z(){return null!==window.GlobalPageRouter&&null!==N()}function B(){return z()&&N()._config||{}}e.createPageRouter=k,e.getMasterRouter=N,e.getMasterRoutes=function(){return P},e.createMasterRouter=function(e){if(r(e))return k(e);if(u(e)){var t=e.routes,n=e.mode,o=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&-1===t.indexOf(r)&&(n[r]=e[r]);return n}(e,["routes","mode"]);if(r(t)&&t.length)return k(t,o,n)}y("Must pass a valid routes array for `createMaster(config: { routes: Array<Route>, [props]: any }): Object<Master>>`")},e.hasMasterRouter=z,e.getMasterConfig=B,Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vue"),require("vue-router")):"function"==typeof define&&define.amd?define(["exports","vue","vue-router"],t):t(e.VueMfe={},e.Vue,e.VueRouter);