/*!
  * vue-mfe v1.1.1
  * (c) 2020 GivingWu
  * @license MIT
  */
var e,n;e=this,n=function(e,n){"use strict";n=n&&n.hasOwnProperty("default")?n.default:n;var t=!1,r=function(e){return Array.isArray(e)},o=function(e){return e&&"function"==typeof e},i=function(e){return e&&"object"==typeof e},u=function(e){return"string"==typeof e},a="undefined"!=typeof console&&"function"==typeof console.warn,c=function(){if(t)throw Error.apply(window,arguments);a&&console.warn.apply(arguments)};function f(e){e&&e instanceof HTMLElement&&("function"==typeof e.remove?e.remove():e.parentNode.removeChild(e))}function s(e){return""+(i(e)?JSON.stringify(e):""+e)}var p=new Map,l=function(){return m().router},h=function(){return l().app},d=function(e){return m(e).globalVar||"__domain__app__"+e},v=function(e){return m(e).name},m=function(e){return void 0===e&&(e="*"),p.get(e)||{}},y=function(e,n){return i(e)&&(e=(n=e).prefix||"*"),!(!u(e)||!i(n))&&p.set(e,n)},w="load-error";function g(e,n,t,r,o){e||e instanceof Error||(e=new Error("\u3010"+(v(r)||r)+"\u3011\uff1a"+n)),t&&!e.code&&(e.code=t),r&&!e.name&&(e.name=r),h().$emit(w,e,o)}var E="LOAD_ERROR_HAPPENED",b="LOAD_DUPLICATE_WITHOUT_PATH",P=new Map,R={};function O(e){return R[e]?Promise.resolve(R[e]):x(e).then(function(n){var u=o(n)?n():n;try{return t&&i(u)&&!r(u)?u:A((r(u)?u:[u]).filter(Boolean),d(e)).then(function(n){return R[e]=n})}catch(e){throw new Error(e)}})}var x=function(e){return Promise.resolve(function(e){var n=P.get(e);if(n&&i(n))return n;try{var t=m(e);if(t&&t.resources||(t=m()),t&&t.resources){if(o(t.resources)){var r=t.resources();return P.set(e,r),r}if(i(t.resources)){var u=t.resources;return P.set(e,u),u}}}catch(n){g(n,"Cannot get the resources .","LOAD_RESOURCES_ERROR",e)}}(e)).then(function(n){return n&&n[e]||c("The App key '"+e+"' cannot be found in "+JSON.stringify(n))})},A=function(e,n){var t=e.filter(function(e){return e.endsWith(".css")}),o=e.filter(function(e){return e.endsWith(".js")});if(r(t)&&t.length&&Promise.all(t.map(function(e){return n=e,(t=document.createElement("link")).type="text/css",t.rel="stylesheet",t.charset="utf-8",t.href=n,t.setAttribute("force",!1),new Promise(function(e,n){var r=setTimeout(function(){return o(!0)},12e3);function o(e){clearTimeout(r),t.onerror=t.onload=t.onreadystatechange=null,e&&t&&f(t)}t.onload=function(){o(),e.apply(void 0,arguments)},t.onerror=function(){for(var e=arguments.length,t=Array(e);e--;)t[e]=arguments[e];o(!0),n(new(Function.prototype.bind.apply(Error,[null].concat(t))))},document.head.appendChild(t)});var n,t})).catch(c),r(o)&&o.length)return M(o.map(function(e){return function(){return function e(n,t,r){return void 0===t&&(t=3),void 0===r&&(r=0),new Promise(function(o,i){return n().then(o).catch(function(u){1!==t?setTimeout(function(){e(n,t-1,r).then(o,i)},r):i(u)})})}(function(){return function(e,n){var t=document.createElement("script");return t.type="text/javascript",t.charset="utf-8",t.src=e,t.async=!0,t.setAttribute("nonce","nonce"),new Promise(function(r,o){var i=setTimeout(function(){return c("Reject script "+e+": LOAD_SCRIPT_TIMEOUT")},12e3);function u(){clearTimeout(i),t.onerror=t.onload=t.onreadystatechange=null,f(t)}function a(){for(var e=arguments.length,t=Array(e);e--;)t[e]=arguments[e];u(),r.apply(void 0,[n?window[n]:void 0].concat(t))}function c(){for(var e=arguments.length,n=Array(e);e--;)n[e]=arguments[e];u(),o(new(Function.prototype.bind.apply(Error,[null].concat(n))))}void 0!==t.readyState?t.onreadystatechange=function(e){"loaded"!==t.readyState&&"complete"!==t.readyState||n&&!window[n]?c("Unknown error happened: "+s(e)):a()}:(t.onload=a,t.onerror=function(n){c("GET "+e+" net::ERR_CONNECTION_REFUSED:  "+s(n))}),document.body.appendChild(t)})}(e,n)})}}));c("No any valid script be found in "+e)},M=function(e){return e.reduce(function(e,n){return e.then(function(e){return n(e)}).catch(function(e){throw e})},Promise.resolve())},T=function(e,n){return void 0===e&&(e=""),void 0===n&&(n="/"),e.split(n).map(function(e){return e.trim()}).filter(Boolean).shift()};function _(e){return!!(i(e)&&(e.fullPath||e.path||e.name)&&e.component)}var j=1,S=0,V={};function C(e){return V[e]===j}function N(e,n){return V[e]=n}var $=function(e){var n=e.name,t=e.next,u=e.to;if(C(n))return!0;var a=h();N(n,S),a.$emit("load-start",e);return O(n).then(function(e){return function(e,n){if(i(e)&&_(e))return l().addRoutes([e]);if(r(e)&&e.every(_))return l().addRoutes(e);var t=L(e),u=m().parentPath;if(i(t)){var a=t.init,c=t.routes,f=t.parentPath;return Promise.resolve(o(a)&&a(h())).then(function(){l().addRoutes(c,f||u)})}throw new Error("\n      Cannot not found 'export default VueMfe.createSubApp({ prefix: "+n+", routes: [] })' in '"+n+"/src/portal.entry.js'\n    ")}(e,n)}).then(function(){return N(n,j),a.$emit("load-success",e),t&&u&&t(u),!0}).catch(function(r){N(n,-1),g(r,"",E,n,e),t&&t(!1)})},L=function(e){return e&&e.default||e};function D(e,n){if(void 0===n&&(n="."),!m())throw new Error("Before you call `VueMfe.Lazy(url: string)` must set its config by `VueMfe.Lazy.setConfig({ resource: Resource[] })`");var t=T(e,n),r=e.slice(t.length+n.length);return t&&O(t).then(function(e){var n=k(L(e),r);return o(n)?n():n})}D.setConfig=function(e){return y(e)};var k=function(e,n){return n.split(".").reduce(function(e,n){return e[n]},e)},I=function(e,n){var t,r=[],o=0,i=0,u="",a=n&&n.delimiter||J,c=n&&n.whitelist||void 0,f=!1;for(;null!==(t=W.exec(e));){var s=t[0],p=t[1],l=t.index;if(u+=e.slice(i,l),i=l+s.length,p)u+=p[1],f=!0;else{var h="",d=t[2],v=t[3],m=t[4],y=t[5];if(!f&&u.length){var w=u.length-1,g=u[w],E=!c||c.indexOf(g)>-1;E&&(h=g,u=u.slice(0,w))}u&&(r.push(u),u="",f=!1);var b="+"===y||"*"===y,P="?"===y||"*"===y,R=v||m,O=h||a;r.push({name:d||o++,prefix:h,delimiter:O,optional:P,repeat:b,pattern:R?H(R):"[^"+B(O===a?O:O+a)+"]+?"})}}(u||i<e.length)&&r.push(u+e.substr(i));return r},U=function(e,n,t){for(var r=(t=t||{}).strict,o=!1!==t.start,i=!1!==t.end,u=t.delimiter||J,a=[].concat(t.endsWith||[]).map(B).concat("$").join("|"),c=o?"^":"",f=0;f<e.length;f++){var s=e[f];if("string"==typeof s)c+=B(s);else{var p=s.repeat?"(?:"+s.pattern+")(?:"+B(s.delimiter)+"(?:"+s.pattern+"))*":s.pattern;n&&n.push(s),s.optional?s.prefix?c+="(?:"+B(s.prefix)+"("+p+"))?":c+="("+p+")?":c+=B(s.prefix)+"("+p+")"}}if(i)r||(c+="(?:"+B(u)+")?"),c+="$"===a?"$":"(?="+a+")";else{var l=e[e.length-1],h="string"==typeof l?l[l.length-1]===u:void 0===l;r||(c+="(?:"+B(u)+"(?="+a+"))?"),h||(c+="(?="+B(u)+"|"+a+")")}return new RegExp(c,function(e){return e&&e.sensitive?"":"i"}(t))},J="/",W=new RegExp(["(\\\\.)","(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?"].join("|"),"g");function B(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function H(e){return e.replace(/([=!:$/()])/g,"\\$1")}function z(e,n){return"/"===n?"/"!==e?F(e):n:F(n)+F(e)}function F(e){return(e="/"!==e?e.replace(/\/?$/,""):e)?function(e){return"/"===e.charAt(0)}(e)?e:"/"+e:"/"}var q={},G=function(e,n){e&&[].concat(e).forEach(function(e){"object"==typeof e?Object.keys(e).forEach(function(t){var r=e[t];q[z(r,n)]=t}):q[z(e,n)]=name})},K=function(e){var n=q[e];if(!n){var t=function(e,n){var t=Object.keys(e);if(t)for(var r=t.map(function(e){return U(I(e))}),o=0,i=r.length;o++<i;)if(r[o].test(n))return t[o]}(q,e);t&&(n=q[t])}return n?[].concat(n):null},Q=function(e){var n=e.map(function(e){return $({name:e})});return Promise.all(n).then(function(e){return e.every(Boolean)})},X=[],Y={},Z=function(e){return X.includes(e)},ee=function(e){return Y[e]},ne=function(e,n,t){return Z(n)?z(e,n):(c("Cannot found the parent path "+n+" "+(t?"of "+t:"")+" in router"),"")};function te(e,n){e.forEach(function(e){var t=e.path,r=e.parentPath,o=e.name,i=e.children,u=e.childrenApps;if(t&&(r?t=ne(t,r,o):n&&(t=ne(t,n,o))),t&&(Z(t)?c("The path "+t+" in pathList has been existed"):X.push(t)),o&&(ee(o)?c("The name "+o+" in pathMap has been existed"):Y[o]=t),G(u,t),i&&i.length)return te(i,t)}),t&&(console.log(X),console.log(Y))}function re(e,n){var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&-1===n.indexOf(r)&&(t[r]=e[r]);return t}function oe(e,t,o){te(e,t),l().matcher=new n(function(e,n,t){var r=e.routes;void 0===r&&(r=[]);var o=re(e,["routes"]),i=n.routes;void 0===i&&(i=[]);var u=re(n,["routes"]);return Object.assign({routes:ie(r,i,t)},u,o)}(function(e){if(e){if(e instanceof n)return e.options;if(r(e))return{routes:e}}return{}}(o||l()),{routes:e},t)).matcher}function ie(e,n,t){var r=t;return n.forEach(function(n){if(u(n.parentPath)?(t=n.parentPath,delete n.parentPath):t=r,u(t))if(""===t)e.push(n);else{var o=function e(n,t){if(void 0===n&&(n=[]),n)for(var r,o=0;o<n.length;o++){if((r=n[o]).path===t)return r;if(r.children&&(r=e(r.children,t)))return r}}(e,t),i=n.path;o&&(o.children||(o.children=[])).push(Object.assign({},n,{path:t&&i.startsWith("/")?i=i.replace(/^\/*/,""):i}))}else e.push(n)}),e}function ue(e){e.beforeEach(function(e,n,t){if((a=e).name&&ee(a.name)||Z(a.path)||0!==a.matched.length)return t();var r=function(e){if(i(e)){var n=e.fullPath||e.path;if(u(n))return T(n);var t=e.name;if(u(t))return T(t,".")}}(e);if(r){var o={name:r,to:e,from:n,next:t};if(!function(e){return V[e]===S}(r)){if(!C(r))return $(o);var a,c=K(e.fullPath||e.path);if(c&&c.length)return function(e,n){var t=n.next,r=n.to,o=n.name;return Q(e).then(function(e){return e&&t&&r&&t(r)}).catch(function(e){g(e,"",E,o,n)})}(c,o);g(null,r+" has been installed but it has no any path like "+e.path,b,r,o)}}})}var ae={sensitive:!1,parentPath:"/",resources:function(){throw new Error("Must implements 'resources: {[prefix: string]: Resources | () => Resources | () => Promise<Resources>}' by yourself.")}};function ce(e){if(!e.router)throw new Error("Missing property 'router: VueRouter' in config \n"+JSON.stringify(e));if(!(e.router instanceof n))throw new Error("The router must be an instance of VueRouter not "+typeof e.router);var t;y(Object.assign({},ae,e)),(t=e.router).addRoutes!==oe&&(t.addRoutes=oe.bind(t)),te(t.options.routes),ue(t)}function fe(e){if(!e.prefix)throw new Error("Missing property 'prefix: string' in config \n"+JSON.stringify(e));if(!e.routes)throw new Error("Missing property 'routes: Route[]' in config \n"+JSON.stringify(e));return y(e),e}var se={version:"1.1.1",Lazy:D,createApp:ce,createSubApp:fe,isInstalled:C};"undefined"==typeof window||!window.Vue||window.VueMfe&&window.VueMfe===se||(window.VueMfe=window.VueMfe&&window.VueMfe.version===se.version?window.VueMfe:se),e.createApp=ce,e.createSubApp=fe,e.default=se,Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("vue-router")):"function"==typeof define&&define.amd?define(["exports","vue-router"],n):n(e.VueMfe={},e.VueRouter);